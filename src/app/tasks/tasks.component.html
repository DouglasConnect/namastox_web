<ul class="nav nav-pills" id="results-tab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="pills-pendingtask-tab" data-bs-toggle="pill" data-bs-target="#pills-pendingtask"
      type="button" role="tab" aria-controls="pills-pendingtask" aria-selected="True">Pending</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="pills-pasttasks-tab" data-bs-toggle="pill" data-bs-target="#pills-pasttasks"
      type="button" role="tab" aria-controls="pills-pasttasks" aria-selected="false">Past</button>
  </li>
</ul>
<div class="tab-content container-fluid" id="pills-tabContent">
  <div class="tab-pane fade show active mt-2" id="pills-pendingtask" role="tabpanel"
    aria-labelledby="pills-pendingtask-tab">
    <div *ngIf="this.pendingTasks.results.length > 0 else noTasks">
      <div class="row">
        <div class="col">
          <select (change)="getPendingTask()" id="selectPendingResult" [(ngModel)]="this.pending_task_selected"
            class="form-select" aria-label="Default select example">
            <option *ngFor="let idx of objectKeys(this.pendingTasks.results)"
              [value]='this.pendingTasks.results[idx].id'>{{this.pendingTasks.results[idx].id}}</option>
          </select>
          <div *ngIf="this.pending_task?.result" class="container-information mt-2 ml-2">
            <div class="card-body">
              <div class="row">
                <div class="col-2 text">
                  <strong>Name</strong>
                </div>
                <div class="col-10">
                  {{this.pending_task['task description'].name}}
                </div>
              </div>
              <div class="row">
                <div class="col-2 text">
                  <strong>Description</strong>
                </div>
                <div class="col-10">
                  {{this.pending_task['task description'].description}}
                </div>
              </div>
            </div>   
              <!-- task form -->
            <task-form [editMode]="false" [task]="this.pending_task"></task-form>
          </div>
        </div>
      </div>
    </div>
    <ng-template #noTasks>No pending Tasks</ng-template>
  </div>

  <div class="tab-pane fade" id="pills-pasttasks" role="tabpanel" aria-labelledby="pills-pasttasks-tab">
    <div class="accordion accordion-flush" id="accordionTasks">
      <div class="accordion-item">
        <h2 class="accordion-header" id="flush-headingTwoTasks">
          <button id="tableCollapseTasks" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOneTasks" aria-expanded="false" aria-controls="flush-collapseOneTasks">
          Select Task
          </button>
        </h2>
        <div id="flush-collapseOneTasks" class="accordion-collapse collapse show"  aria-labelledby="flush-headingTwoTasks" data-bs-parent="#accordionTasks">
          <div class="accordion-body">
            <div class="row">
              <div class="col">
                <table id="dtTasks" class="display compact">
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Summary</th>
                      <th>Value</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr (click)="selectTask(result.id)" *ngFor="let result of this.results.results">
                    <td>{{result.date | formatDate}}</td>
                      <td>{{result.id}}</td>
                      <td>{{result.name}}</td>
                      <td>{{result.summary | slice:0:150}}...</td>
                      <td *ngIf="isObject(result.values[0]) else reportTD">{{result.values[0].parameter}},{{result.values[0].value}},{{result.values[0].unit}} <span *ngIf="result.values.length > 0">...</span></td>
                    <ng-template #reportTD><td>{{result.values[0] | slice:0:20}}...  </td></ng-template>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="accordion-item">
        <h2 class="accordion-header " id="flush-headingTwoTasks">
          <button (click)="showTablePastTasks()" id="pastCollapseTasks" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwoTasks" aria-expanded="true" aria-controls="flush-collapseTwoTasks">
            {{this.results?.resultSelected['task description']?.id}}
          </button>
        </h2>
        <div id="flush-collapseTwoTasks" class="accordion-collapse collapse"  aria-labelledby="flush-headingTwoTasks" data-bs-parent="#accordionTasks">
          <div class="accordion-body">
            <div class="mt-2" *ngIf="this.results.resultSelected.result && !this.global.editModeTasks">
              <hr>
              <div class="card-body mb-3">
                <div class="row">
                  <div class="col-2 text">
                    <strong>Date</strong>
                  </div>
                  <div class="col-10">
                    {{this.results.resultSelected.result['date']}}
                  </div>
                </div>
                <div class="row">
                  <div class="col-2 text">
                    <strong>Name</strong>
                  </div>
                  <div class="col-10">
                    {{this.results.resultSelected['task description'].name}}
                  </div>
                </div>
                <div class="row">
                  <div class="col-2 text">
                    <strong>Description</strong>
                  </div>
                  <div class="col-10">
                    {{this.results.resultSelected['task description'].description}}
                  </div>
                </div>
              </div>
              <div
               class="card-body">
                <div class="row pt-1 pb-1">
                  <div *ngIf="this.results.resultSelected.result.result_type === 'text'" class="col-2 text  border-bottom">
                    Report
                  </div>
                  <div *ngIf='this.results.resultSelected.result.result_type === "value"' class="col-2 text  border-bottom">
                    Values
                  </div>
                  <div class="col border-bottom">
                    <table *ngIf="isObject(this.results.resultSelected.result.values[0])"  class="table table-borderless">
                      <thead class="text">
                        <tr>
                          <th >Parameter</th>
                          <th >Value</th>
                          <th >Unit</th>
                        </tr>
                      </thead>
                      <tbody *ngFor="let idx of objectKeys(this.results.resultSelected.result.values)">
                        <tr>
                          <td>{{this.results.resultSelected.result.values[idx].parameter}}</td>
                          <td>{{this.results.resultSelected.result.values[idx].value.toString() | slice:0:8}}</td>
                          <td>{{this.results.resultSelected.result.values[idx].unit}}</td>
                        </tr>
                      </tbody>
                      </table>
                      <div *ngIf="this.results.resultSelected.result.result_type === 'text'" class="col">
                        {{this.results.resultSelected.result.values[0]}}
                      </div>
                  </div>
                </div>
                <div class="row pt-1 pb-1" *ngIf="this.results.resultSelected.result.uncertainty">
                  <div class="col-2 text  border-bottom">
                    Uncertainty
                  </div>
                  <div class="col border-bottom">
                    {{this.results.resultSelected.result.uncertainty}}
                  </div>
                </div>
                <div *ngIf="this.results.resultSelected.result.links" class="row pt-1 pb-1">
                  <div class="col-2 text  border-bottom d-flex  align-items-center">
                    Documentation
                  </div>
                  <div class="col border-bottom">
                    <div class="d-inline mx-1" *ngFor="let idx of objectKeys(this.results.resultSelected.result.links)">
                      <button (click)="downloadFile(this.results.resultSelected.result.links[idx].File)" class="btn btn-outline-success mt-2 mb-2">{{this.results.resultSelected.result.links[idx].label}} </button>
                    </div>
                  </div>
                </div>
                <div class="row pt-1 pb-1">
                  <div class="col-2 text  border-bottom">
                    Summary
                  </div>
                  <div class="col border-bottom">
                    {{this.results.resultSelected.result.summary}}
                  </div>
                </div>
                <div  *ngIf="this.results.resultSelected?.result?.substance?.length > 1" class="row pt-1 pb-1">
                  <div class="col-2 text">
                  Substance
                  </div>
                  <div   class="col">
                    <table id="dtSubstancesTasks" class="table table-borderless">
                      <thead class="text">
                        <tr>
                          <th  style="text-align: center;">Name</th>
                          <th  style="text-align: center;">CASRN</th>
                          <th style="text-align: center;">SMILES</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr  *ngFor="let idx of objectKeys(this.results.resultSelected.result.substance)">
                          <td style="vertical-align: middle;text-align: center;">{{this.results.resultSelected.result.substance[idx].name}}</td>
                          <td style="vertical-align: middle;text-align: center;">{{this.results.resultSelected.result.substance[idx].CASRN}}</td>
                          <td style="text-align: center;"><canvas [id]="'taskCanvas'+idx"></canvas></td>
                        </tr>
                      </tbody>
                      <!-- <tbody *ngIf="this.results.resultSelected.substance instanceof Object">
                        <td>{{this.results.resultSelected.substance.name}}</td>
                        <td>{{this.results.resultSelected.substance.CASRN}}</td>
                        <td><canvas [id]="'taskCanvas'+0"></canvas></td>
                      </tbody> -->
                    </table>
                  </div>
                </div>
                <div class="row">
                  <button (click)="editTask()" class="btn btn-ets-edit">Edit</button>
                </div>
              </div>
            </div>
                <task-form *ngIf="this.global.editModeTasks" [editMode]="true" [task]="this.results.resultSelected"></task-form >
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


